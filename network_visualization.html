<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Red de Personas - Visualización Interactiva</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        .sidebar {
            width: 300px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            overflow-y: auto;
            box-shadow: 2px 0 20px rgba(0,0,0,0.1);
        }

        .field-group {
            margin-bottom: 20px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .field-group:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .field-header {
            padding: 15px;
            cursor: pointer;
            font-weight: bold;
            color: white;
            position: relative;
            transition: all 0.3s ease;
        }

        .field-header:hover {
            filter: brightness(110%);
        }

        .field-header::after {
            content: '▼';
            position: absolute;
            right: 15px;
            transition: transform 0.3s ease;
        }

        .field-header.collapsed::after {
            transform: rotate(-90deg);
        }

        .especie { background: linear-gradient(45deg, #FF6B6B, #FF8E8E); }
        .dispositivo { background: linear-gradient(45deg, #4ECDC4, #45B7B8); }
        .estudio { background: linear-gradient(45deg, #45B7D1, #6C5CE7); }
        .proyecto { background: linear-gradient(45deg, #A8E6CF, #88D8A3); }
        .status { background: linear-gradient(45deg, #FFD93D, #FF6B6B); }
        .institucion { background: linear-gradient(45deg, #6C5CE7, #A8E6CF); }

        .field-content {
            background: white;
            max-height: 200px;
            overflow-y: auto;
            transition: max-height 0.3s ease;
        }

        .field-content.collapsed {
            max-height: 0;
        }

        .checkbox-item {
            padding: 10px 15px;
            display: flex;
            align-items: center;
            transition: background-color 0.2s ease;
        }

        .checkbox-item:hover {
            background-color: #f8f9ff;
        }

        .checkbox-item input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.2);
        }

        .visualization {
            flex: 1;
            position: relative;
            background: rgba(255, 255, 255, 0.1);
        }

        .person-tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 14px;
            pointer-events: none;
            z-index: 1000;
            max-width: 300px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        .node {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .node:hover {
            filter: brightness(120%);
        }

        .node text {
            font-size: 12px;
            fill: white;
            text-anchor: middle;
            dominant-baseline: middle;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
        }

        .link {
            stroke-width: 2;
            opacity: 0.6;
            transition: all 0.3s ease;
        }

        .link:hover {
            opacity: 1;
            stroke-width: 3;
        }

        .legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .legend-color {
            width: 20px;
            height: 3px;
            margin-right: 10px;
            border-radius: 2px;
        }

        .stats {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .clear-filters {
            margin-top: 20px;
            padding: 10px 20px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .clear-filters:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <h2 style="text-align: center; color: #333; margin-bottom: 30px;">Filtros de Búsqueda</h2>
            
            <div class="field-group">
                <div class="field-header especie" onclick="toggleField('especie')">
                    Especie
                </div>
                <div class="field-content" id="especie-content">
                    <div class="checkbox-item"><input type="checkbox" id="ovina" onchange="updateVisualization()"> Ovina</div>
                    <div class="checkbox-item"><input type="checkbox" id="caprina" onchange="updateVisualization()"> Caprina</div>
                    <div class="checkbox-item"><input type="checkbox" id="vacuna" onchange="updateVisualization()"> Vacuna</div>
                    <div class="checkbox-item"><input type="checkbox" id="porcina" onchange="updateVisualization()"> Porcina</div>
                    <div class="checkbox-item"><input type="checkbox" id="avicola" onchange="updateVisualization()"> Avícola</div>
                    <div class="checkbox-item"><input type="checkbox" id="cunicula" onchange="updateVisualization()"> Cunícola</div>
                </div>
            </div>

            <div class="field-group">
                <div class="field-header dispositivo" onclick="toggleField('dispositivo')">
                    Dispositivos
                </div>
                <div class="field-content" id="dispositivo-content">
                    <div class="checkbox-item"><input type="checkbox" id="drones" onchange="updateVisualization()"> Drones</div>
                    <div class="checkbox-item"><input type="checkbox" id="rfid" onchange="updateVisualization()"> RFID</div>
                    <div class="checkbox-item"><input type="checkbox" id="collares" onchange="updateVisualization()"> Collares</div>
                    <div class="checkbox-item"><input type="checkbox" id="camaras" onchange="updateVisualization()"> Cámaras de visión</div>
                    <div class="checkbox-item"><input type="checkbox" id="ia" onchange="updateVisualization()"> IA</div>
                    <div class="checkbox-item"><input type="checkbox" id="alimentadores" onchange="updateVisualization()"> Alimentadores automáticos</div>
                    <div class="checkbox-item"><input type="checkbox" id="basculas" onchange="updateVisualization()"> Básculas</div>
                    <div class="checkbox-item"><input type="checkbox" id="acusticos" onchange="updateVisualization()"> Sensores acústicos</div>
                    <div class="checkbox-item"><input type="checkbox" id="movimiento" onchange="updateVisualization()"> Sensores de movimiento</div>
                    <div class="checkbox-item"><input type="checkbox" id="vallados" onchange="updateVisualization()"> Vallados virtuales</div>
                </div>
            </div>

            <div class="field-group">
                <div class="field-header estudio" onclick="toggleField('estudio')">
                    Estudio
                </div>
                <div class="field-content" id="estudio-content">
                    <div class="checkbox-item"><input type="checkbox" id="alimenticio" onchange="updateVisualization()"> Comportamiento alimenticio</div>
                    <div class="checkbox-item"><input type="checkbox" id="social" onchange="updateVisualization()"> Comportamiento social</div>
                    <div class="checkbox-item"><input type="checkbox" id="manejo" onchange="updateVisualization()"> Manejo</div>
                    <div class="checkbox-item"><input type="checkbox" id="nutricion" onchange="updateVisualization()"> Nutrición</div>
                    <div class="checkbox-item"><input type="checkbox" id="salud" onchange="updateVisualization()"> Salud</div>
                </div>
            </div>

            <div class="field-group">
                <div class="field-header proyecto" onclick="toggleField('proyecto')">
                    Proyectos
                </div>
                <div class="field-content" id="proyecto-content">
                    <div class="checkbox-item"><input type="checkbox" id="project1" onchange="updateVisualization()"> Project1</div>
                    <div class="checkbox-item"><input type="checkbox" id="project2" onchange="updateVisualization()"> Project2</div>
                    <div class="checkbox-item"><input type="checkbox" id="project3" onchange="updateVisualization()"> Project3</div>
                    <div class="checkbox-item"><input type="checkbox" id="project4" onchange="updateVisualization()"> Project4</div>
                </div>
            </div>

            <div class="field-group">
                <div class="field-header status" onclick="toggleField('status')">
                    Status
                </div>
                <div class="field-content" id="status-content">
                    <div class="checkbox-item"><input type="checkbox" id="ip" onchange="updateVisualization()"> IP</div>
                    <div class="checkbox-item"><input type="checkbox" id="predoc" onchange="updateVisualization()"> Predoc</div>
                    <div class="checkbox-item"><input type="checkbox" id="postdoc" onchange="updateVisualization()"> Postdoc</div>
                    <div class="checkbox-item"><input type="checkbox" id="tecnico" onchange="updateVisualization()"> Técnico</div>
                </div>
            </div>

            <div class="field-group">
                <div class="field-header institucion" onclick="toggleField('institucion')">
                    Institución
                </div>
                <div class="field-content" id="institucion-content">
                    <div class="checkbox-item"><input type="checkbox" id="upv" onchange="updateVisualization()"> UPV</div>
                    <div class="checkbox-item"><input type="checkbox" id="udl" onchange="updateVisualization()"> UdL</div>
                    <div class="checkbox-item"><input type="checkbox" id="uco" onchange="updateVisualization()"> UCO</div>
                    <div class="checkbox-item"><input type="checkbox" id="usal" onchange="updateVisualization()"> USAL</div>
                    <div class="checkbox-item"><input type="checkbox" id="uab" onchange="updateVisualization()"> UAB</div>
                </div>
            </div>

            <button class="clear-filters" onclick="clearAllFilters()">Limpiar Filtros</button>
        </div>

        <div class="visualization">
            <svg id="network"></svg>
            <div class="legend">
                <h4 style="margin-top: 0;">Tipos de Conexión</h4>
                <div class="legend-item">
                    <div class="legend-color" style="background: #FF6B6B;"></div>
                    <span>Especie</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #4ECDC4;"></div>
                    <span>Dispositivo</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #45B7D1;"></div>
                    <span>Estudio</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #A8E6CF;"></div>
                    <span>Proyecto</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #FFD93D;"></div>
                    <span>Status</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #6C5CE7;"></div>
                    <span>Institución</span>
                </div>
            </div>
            <div class="stats">
                <div id="stats-content">
                    <strong>Personas mostradas:</strong> <span id="person-count">0</span><br>
                    <strong>Conexiones:</strong> <span id="connection-count">0</span>
                </div>
            </div>
        </div>
    </div>

    <div class="person-tooltip" id="tooltip" style="display: none;"></div>

    <script>
        // Datos de ejemplo
        const people = [
            {
                id: 1, name: "Ana García", especie: ["ovina", "caprina"], dispositivo: ["drones", "rfid"], 
                estudio: ["alimenticio", "social"], proyecto: ["project1"], status: ["ip"], institucion: ["upv"]
            },
            {
                id: 2, name: "Carlos López", especie: ["vacuna"], dispositivo: ["collares", "basculas"], 
                estudio: ["manejo", "nutricion"], proyecto: ["project1", "project2"], status: ["postdoc"], institucion: ["upv"]
            },
            {
                id: 3, name: "María Rodríguez", especie: ["porcina", "avicola"], dispositivo: ["ia", "camaras"], 
                estudio: ["salud"], proyecto: ["project2"], status: ["predoc"], institucion: ["udl"]
            },
            {
                id: 4, name: "José Martín", especie: ["cunicula"], dispositivo: ["alimentadores", "acusticos"], 
                estudio: ["alimenticio"], proyecto: ["project3"], status: ["ip"], institucion: ["udl"]
            },
            {
                id: 5, name: "Laura Sánchez", especie: ["ovina", "vacuna"], dispositivo: ["movimiento", "vallados"], 
                estudio: ["social", "manejo"], proyecto: ["project1", "project3"], status: ["tecnico"], institucion: ["udl"]
            },
            {
                id: 6, name: "David Fernández", especie: ["caprina", "porcina"], dispositivo: ["drones", "ia"], 
                estudio: ["nutricion", "salud"], proyecto: ["project4"], status: ["postdoc"], institucion: ["uco"]
            },
            {
                id: 7, name: "Elena Jiménez", especie: ["avicola"], dispositivo: ["rfid", "collares"], 
                estudio: ["alimenticio", "manejo"], proyecto: ["project2", "project4"], status: ["ip"], institucion: ["uco"]
            },
            {
                id: 8, name: "Miguel Torres", especie: ["vacuna", "cunicula"], dispositivo: ["basculas", "camaras"], 
                estudio: ["social"], proyecto: ["project1"], status: ["predoc"], institucion: ["uco"]
            },
            {
                id: 9, name: "Isabel Ruiz", especie: ["ovina", "porcina"], dispositivo: ["alimentadores", "movimiento"], 
                estudio: ["salud", "nutricion"], proyecto: ["project3", "project4"], status: ["tecnico"], institucion: ["usal"]
            },
            {
                id: 10, name: "Andrés Moreno", especie: ["caprina", "avicola"], dispositivo: ["acusticos", "vallados"], 
                estudio: ["alimenticio"], proyecto: ["project2"], status: ["ip"], institucion: ["usal"]
            },
            {
                id: 11, name: "Carmen Díaz", especie: ["cunicula", "ovina"], dispositivo: ["drones", "basculas"], 
                estudio: ["social", "manejo"], proyecto: ["project1", "project4"], status: ["postdoc"], institucion: ["usal"]
            },
            {
                id: 12, name: "Roberto Herrera", especie: ["vacuna"], dispositivo: ["ia", "rfid"], 
                estudio: ["salud"], proyecto: ["project3"], status: ["predoc"], institucion: ["uab"]
            },
            {
                id: 13, name: "Lucía Vega", especie: ["porcina", "caprina"], dispositivo: ["collares", "alimentadores"], 
                estudio: ["nutricion", "alimenticio"], proyecto: ["project2", "project3"], status: ["ip"], institucion: ["uab"]
            },
            {
                id: 14, name: "Francisco Castro", especie: ["avicola", "cunicula"], dispositivo: ["camaras", "acusticos"], 
                estudio: ["manejo", "social"], proyecto: ["project4"], status: ["tecnico"], institucion: ["uab"]
            },
            {
                id: 15, name: "Patricia Ramos", especie: ["ovina", "vacuna"], dispositivo: ["movimiento", "vallados"], 
                estudio: ["salud", "alimenticio"], proyecto: ["project1", "project2"], status: ["postdoc"], institucion: ["uab"]
            }
        ];

        const colorMap = {
            especie: "#FF6B6B",
            dispositivo: "#4ECDC4", 
            estudio: "#45B7D1",
            proyecto: "#A8E6CF",
            status: "#FFD93D",
            institucion: "#6C5CE7"
        };

        let simulation;
        const svg = d3.select("#network");
        const tooltip = d3.select("#tooltip");

        function toggleField(fieldName) {
            const content = document.getElementById(fieldName + '-content');
            const header = content.previousElementSibling;
            
            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                header.classList.remove('collapsed');
            } else {
                content.classList.add('collapsed');
                header.classList.add('collapsed');
            }
        }

        function getSelectedFilters() {
            const filters = {};
            const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
            
            checkboxes.forEach(checkbox => {
                const field = getFieldFromId(checkbox.id);
                if (!filters[field]) filters[field] = [];
                filters[field].push(checkbox.id);
            });
            
            return filters;
        }

        function getFieldFromId(id) {
            const fieldMapping = {
                'ovina': 'especie', 'caprina': 'especie', 'vacuna': 'especie', 'porcina': 'especie', 'avicola': 'especie', 'cunicula': 'especie',
                'drones': 'dispositivo', 'rfid': 'dispositivo', 'collares': 'dispositivo', 'camaras': 'dispositivo', 'ia': 'dispositivo', 
                'alimentadores': 'dispositivo', 'basculas': 'dispositivo', 'acusticos': 'dispositivo', 'movimiento': 'dispositivo', 'vallados': 'dispositivo',
                'alimenticio': 'estudio', 'social': 'estudio', 'manejo': 'estudio', 'nutricion': 'estudio', 'salud': 'estudio',
                'project1': 'proyecto', 'project2': 'proyecto', 'project3': 'proyecto', 'project4': 'proyecto',
                'ip': 'status', 'predoc': 'status', 'postdoc': 'status', 'tecnico': 'status',
                'upv': 'institucion', 'udl': 'institucion', 'uco': 'institucion', 'usal': 'institucion', 'uab': 'institucion'
            };
            return fieldMapping[id];
        }

        function filterPeople(filters) {
            if (Object.keys(filters).length === 0) return people;
            
            return people.filter(person => {
                return Object.keys(filters).some(field => {
                    return filters[field].some(value => person[field].includes(value));
                });
            });
        }

        function createConnections(filteredPeople) {
            const connections = [];
            const connectionTypes = new Set();
            
            for (let i = 0; i < filteredPeople.length; i++) {
                for (let j = i + 1; j < filteredPeople.length; j++) {
                    const person1 = filteredPeople[i];
                    const person2 = filteredPeople[j];
                    const commonFields = [];
                    
                    ['especie', 'dispositivo', 'estudio', 'proyecto', 'status', 'institucion'].forEach(field => {
                        const common = person1[field].filter(x => person2[field].includes(x));
                        if (common.length > 0) {
                            commonFields.push({field, common});
                        }
                    });
                    
                    if (commonFields.length > 0) {
                        const primaryConnection = commonFields[0];
                        connections.push({
                            source: person1,
                            target: person2,
                            type: primaryConnection.field,
                            commonFields: commonFields
                        });
                        connectionTypes.add(primaryConnection.field);
                    }
                }
            }
            
            return connections;
        }

        function getNodeSize(person, filteredPeople) {
            const sameInstitution = filteredPeople.filter(p => 
                p.institucion.some(inst => person.institucion.includes(inst))
            );
            
            const hasIP = sameInstitution.some(p => p.status.includes('ip'));
            
            if (person.status.includes('ip')) {
                return hasIP ? 25 : 20;
            } else if (hasIP) {
                return 15;
            } else {
                return 20;
            }
        }

        function positionSatellites(nodes, links) {
            const institutionGroups = {};
            
            nodes.forEach(node => {
                node.institucion.forEach(inst => {
                    if (!institutionGroups[inst]) institutionGroups[inst] = [];
                    institutionGroups[inst].push(node);
                });
            });
            
            Object.values(institutionGroups).forEach(group => {
                const ips = group.filter(p => p.status.includes('ip'));
                const nonIps = group.filter(p => !p.status.includes('ip'));
                
                if (ips.length > 0 && nonIps.length > 0) {
                    ips.forEach(ip => {
                        const satelliteRadius = 80;
                        const angleStep = (2 * Math.PI) / nonIps.length;
                        
                        nonIps.forEach((satellite, index) => {
                            const angle = index * angleStep;
                            satellite.fx = ip.x + Math.cos(angle) * satelliteRadius;
                            satellite.fy = ip.y + Math.sin(angle) * satelliteRadius;
                        });
                    });
                }
            });
        }

        function updateVisualization() {
            const filters = getSelectedFilters();
            const filteredPeople = filterPeople(filters);
            const connections = createConnections(filteredPeople);
            
            // Actualizar estadísticas
            document.getElementById('person-count').textContent = filteredPeople.length;
            document.getElementById('connection-count').textContent = connections.length;
            
            const width = document.querySelector('.visualization').clientWidth;
            const height = document.querySelector('.visualization').clientHeight;
            
            svg.selectAll("*").remove();
            svg.attr("width", width).attr("height", height);
            
            if (filteredPeople.length === 0) return;
            
            // Crear simulación
            simulation = d3.forceSimulation(filteredPeople)
                .force("link", d3.forceLink(connections).id(d => d.id).distance(100))
                .force("charge", d3.forceManyBody().strength(-300))
                .force("center", d3.forceCenter(width / 2, height / 2))
                .force("collision", d3.forceCollide().radius(d => getNodeSize(d, filteredPeople) + 5));
            
            // Crear enlaces
            const link = svg.append("g")
                .selectAll("line")
                .data(connections)
                .enter().append("line")
                .attr("class", "link")
                .style("stroke", d => colorMap[d.type])
                .style("stroke-width", 2)
                .style("opacity", 0.6);
            
            // Crear nodos
            const node = svg.append("g")
                .selectAll("g")
                .data(filteredPeople)
                .enter().append("g")
                .attr("class", "node")
                .call(d3.drag()
                    .on("start", dragstarted)
                    .on("drag", dragged)
                    .on("end", dragended));
            
            // Círculos de nodos
            node.append("circle")
                .attr("r", d => getNodeSize(d, filteredPeople))
                .style("fill", d => {
                    const gradient = svg.append("defs").append("radialGradient")
                        .attr("id", `grad${d.id}`)
                        .attr("cx", "30%").attr("cy", "30%");
                    
                    gradient.append("stop").attr("offset", "0%").style("stop-color", "#fff").style("stop-opacity", 0.3);
                    gradient.append("stop").attr("offset", "100%").style("stop-color", colorMap[d.institucion[0]]).style("stop-opacity", 1);
                    
                    return `url(#grad${d.id})`;
                })
                .style("stroke", d => d.status.includes('ip') ? "#FFD700" : "#fff")
                .style("stroke-width", d => d.status.includes('ip') ? 3 : 2);
            
            // Texto de nodos
            node.append("text")
                .text(d => d.name.split(' ')[0])
                .style("font-size", "12px")
                .style("fill", "white")
                .style("text-anchor", "middle")
                .style("dominant-baseline", "middle")
                .style("font-weight", "bold")
                .style("text-shadow", "1px 1px 2px rgba(0,0,0,0.7)");
            
            // Eventos del mouse
            node.on("click", function(event, d) {
                showTooltip(event, d);
            }).on("mouseover", function(event, d) {
                d3.select(this).select("circle").style("filter", "brightness(120%)");
            }).on("mouseout", function(event, d) {
                d3.select(this).select("circle").style("filter", "brightness(100%)");
            });
            
            // Actualizar posiciones en cada tick
            simulation.on("tick", () => {
                link.attr("x1", d => d.source.x)
                    .attr("y1", d => d.source.y)
                    .attr("x2", d => d.target.x)
                    .attr("y2", d => d.target.y);
                
                node.attr("transform", d => `translate(${d.x},${d.y})`);
            });
        }

        function showTooltip(event, person) {
            const tooltip = document.getElementById('tooltip');
            let content = `<strong>${person.name}</strong><br><br>`;
            
            content += `<strong>Especie:</strong> ${person.especie.join(', ')}<br>`;
            content += `<strong>Dispositivos:</strong> ${person.dispositivo.join(', ')}<br>`;
            content += `<strong>Estudios:</strong> ${person.estudio.join(', ')}<br>`;
            content += `<strong>Proyectos:</strong> ${person.proyecto.join(', ')}<br>`;
            content += `<strong>Status:</strong> ${person.status.join(', ')}<br>`;
            content += `<strong>Institución:</strong> ${person.institucion.join(', ')}`;
            
            tooltip.innerHTML = content;
            tooltip.style.display = 'block';
            tooltip.style.left = (event.pageX + 10) + 'px';
            tooltip.style.top = (event.pageY - 10) + 'px';
            
            // Ocultar tooltip después de 5 segundos
            setTimeout(() => {
                tooltip.style.display = 'none';
            }, 5000);
        }

        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }

        function clearAllFilters() {
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;
            });
            updateVisualization();
        }

        // Ocultar tooltip al hacer clic fuera
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.node')) {
                document.getElementById('tooltip').style.display = 'none';
            }
        });

        // Inicializar la visualización
        window.addEventListener('resize', updateVisualization);
        updateVisualization();
    </script>
</body>
</html>